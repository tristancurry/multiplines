<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multiply</title>
    <style>
        input {
            display: block;
            width: 100%;
        }

        datalist {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            writing-mode: vertical-lr;
            width: 100%;
        }

        #numberlines {
            position: relative;
            width: 50%;
        }
    </style>
</head>
<body>
    <div id="numberlines">
        <input type="range" id="nl_static" list="values_static" value="0" step="any" max="10"/>
        <datalist id="values_static">
            <option value="0" label="0"></option>
            <option value="20" label="20"></option>
            <option value="40" label="40"></option>
            <option value="60" label="60"></option>
            <option value="80" label="80"></option>
            <option value="100" label="100"></option>
        </datalist>
        <!-- TODO: set min and max dynamically, and build datalists dynamically -->
        <input type="range" id="nl_dynamic" list="values_dynamic" max="300" value="0" step="any"/>
        <datalist id="values_dynamic">
            <option value="0" label="0"></option>
            <option value="60" label="60"></option>
            <option value="120" label="120"></option>
            <option value="180" label="180"></option>
            <option value="240" label="240"></option>
            <option value="3000" label="300"></option>
        </datalist>


        <svg width="500" height="500" version="1.1" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
            <g fill="none" stroke="#000">
             <path d="m-25 35.868h150"/>
             <path d="m-25 70.5h150"/>
             <path id="path468" d="m5.5 30.5v10.735" fill="none" stroke="#000" stroke-linecap="square"/>
            </g>

             <use transform="translate(10)" xlink:href="#path468"/>
             <use transform="translate(20)" xlink:href="#path468"/>
             <use transform="translate(30)" xlink:href="#path468"/>
             <use transform="translate(40)" xlink:href="#path468"/>
             <use transform="translate(50)" xlink:href="#path468"/>
             <use transform="translate(60)" xlink:href="#path468"/>
             <use transform="translate(70)" xlink:href="#path468"/>
             <use transform="translate(80)" xlink:href="#path468"/>
             <use transform="translate(90)" xlink:href="#path468"/>
            
           </svg>
    </div>


    <script>
        let factor = 3;
        let divide = false; 

        //give the sliders and their containing element a reference in code.
        //Variable names are the same as element id just for consistency,
        //it doesn't cause awkward collisions anywhere.
        const numberlines = document.getElementById('numberlines');
        const nl_static = document.getElementById('nl_static');
        const nl_dynamic = document.getElementById('nl_dynamic');

        //set event listeners on the two sliders
        //if there were more sliders to synchronise, a loop over the input elements
        //in the containing div would be a good way to set these up.
        //NB: there's a difference between input.value, and the input's HTML 'value' attribute
        nl_static.addEventListener('input', event => {
            nl_dynamic.value = (1/factor)*nl_static.value;
        });

        nl_dynamic.addEventListener('input', event => {
            nl_static.value = (factor)*nl_dynamic.value;
        });


        generateDataList(document.getElementById('values_static'));
        generateDataList(document.getElementById('values_dynamic'), 30, 0, 30);
        updateScaleFactor(2);
        generateAxis(document.getElementsByTagName('svg')[0]);

        //this function does all the various things that need to happen whenever the scale factor is adjusted.
        function updateScaleFactor(n) {
            factor = n;
            generateDataList(document.getElementById('values_dynamic'), 10/factor, 0, parseInt(nl_static.getAttribute('max'))/factor);
            nl_dynamic.setAttribute('max', parseInt(nl_static.getAttribute('max'))/factor);
            if(!divide) {
                nl_static.dispatchEvent(new Event('input'));
            } else {
                nl_dynamic.dispatchEvent(new Event('input'));
            }

        }

        //this is used to generate the 'options' elements for the tick marks on each input range
        function generateDataList (target, divisions_major = 10, min = 0, max = 10) {
            //clear existing option elements
            while (target.firstChild) {
                target.removeChild(target.firstChild);
            }
            //replace with appropriate values
            let increment = (max - min)/divisions_major;
            for (let i = 0; i <= divisions_major; i++) {
                let val = min + i*increment;
                let o = document.createElement('option');
                o.setAttribute('value', val);
                o.setAttribute('label', val);
                target.appendChild(o);       
            }
        }

        //this is used to produce the SVG axis with appropriate spacings and numbering of tick marks
        function generateAxis (target, spacing, origin_position) {
            const xmlns = 'http://www.w3.org/2000/svg';
            const xlink = 'http://www.w3.org/1999/xlink';


            let n_ticks = Math.floor(100/spacing);
            for (let i = 0; i < n_ticks; i++) {
                let tick = document.createElementNS(xmlns, 'use');
                tick.setAttribute('transform', `translate(${i*spacing}, 35)`);
                tick.setAttributeNS(xlink, 'xlink:href', '#path468');
                target.appendChild(tick);
            }

        }

        
    </script>
</body>
</html>